bash <<'VPNFIX'
set -e

echo "[ProtonVPN] Installing..."

sudo apt update
sudo apt install -y wget gnupg apt-transport-https

# Add repo + key
wget -qO - https://repo.protonvpn.com/debian/public_key.asc | \
    gpg --dearmor | sudo tee /etc/apt/trusted.gpg.d/protonvpn.gpg >/dev/null

echo "deb https://repo.protonvpn.com/debian stable main" | \
    sudo tee /etc/apt/sources.list.d/protonvpn.list >/dev/null

sudo apt update

# Try modern package first
if sudo apt install -y proton-vpn-gnome-desktop; then
    VPN_CMD="protonvpn-app"
else
    # fallback older systems
    sudo apt install -y protonvpn-app || true
    VPN_CMD="protonvpn-app"
fi

echo "[ProtonVPN] Creating launcher..."

mkdir -p ~/bin
cat > ~/bin/vpn <<EOF
#!/bin/bash
$VPN_CMD
EOF

chmod +x ~/bin/vpn

grep -qxF 'export PATH="$HOME/bin:$PATH"' ~/.bashrc || \
echo 'export PATH="$HOME/bin:$PATH"' >> ~/.bashrc

echo "[âœ“] ProtonVPN installed"
echo "Run: vpn"
VPNFIX
