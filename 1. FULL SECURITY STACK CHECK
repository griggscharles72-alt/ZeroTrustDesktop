sudo bash -c '
echo "========== FULL SECURITY STACK CHECK =========="

echo "[1] SYSTEM UPDATE"
apt update -y >/dev/null

echo "[2] CORE SECURITY PACKAGES"
apt install -y ufw fail2ban apparmor apparmor-utils apparmor-profiles apparmor-profiles-extra >/dev/null

echo "[3] ENABLE SERVICES"
systemctl enable --now apparmor
systemctl enable --now fail2ban

echo "[4] APPARMOR MODES"
aa-enforce /etc/apparmor.d/* 2>/dev/null || true
aa-complain /etc/apparmor.d/code* 2>/dev/null || true
aa-complain /etc/apparmor.d/python* 2>/dev/null || true

echo "[5] FIREWALL BASELINE"
ufw default deny incoming
ufw default allow outgoing
ufw allow OpenSSH 2>/dev/null || true
ufw --force enable

echo "[6] OPTIONAL SERVICES CLEANUP"
systemctl disable --now nginx 2>/dev/null || true

echo
echo "========== STATUS =========="

echo "--- AppArmor ---"
aa-status | head -n 20

echo
echo "--- Firewall ---"
ufw status verbose

echo
echo "--- Fail2Ban ---"
systemctl is-active fail2ban

echo
echo "--- Listening Ports ---"
ss -tulnp | grep LISTEN

echo
echo "========== COMPLETE =========="
'
