bash <<'BOOTSTRAP'
set -e

echo "[VSCode] Installing extensions..."

EXTENSIONS=(
# Python core
ms-python.python
ms-python.vscode-pylance
ms-python.debugpy
ms-python.vscode-python-envs

# Jupyter
ms-toolsai.jupyter
ms-toolsai.jupyter-keymap
ms-toolsai.jupyter-renderers
ms-toolsai.vscode-jupyter-cell-tags
ms-toolsai.vscode-jupyter-slideshow

# Bash / Shell
mads-hartmann.bash-ide-vscode
timonwong.shellcheck
foxundermoon.shell-format

# Execution / Run control (prompts before execute)
usernamehw.execute
formulahendry.code-runner

# Dev / Containers
ms-azuretools.vscode-docker
ms-azuretools.vscode-containers

# Git / YAML / Hex
eamodio.gitlens
redhat.vscode-yaml
ms-vscode.hexeditor
)

for ext in "${EXTENSIONS[@]}"; do
    code --install-extension "$ext" || true
done

echo "[VSCode] Installing extension dev tools..."
sudo apt update -y
sudo apt install -y nodejs npm
sudo npm install -g yo generator-code vsce

echo "[VSCode] Configuring settings..."

mkdir -p ~/.config/Code/User

cat > ~/.config/Code/User/settings.json <<'EOF'
{
    "python.defaultInterpreterPath": "/usr/bin/python3",
    "python.terminal.activateEnvironment": true,

    "terminal.integrated.defaultProfile.linux": "bash",
    "terminal.integrated.shellIntegration.enabled": true,
    "terminal.integrated.inheritEnv": true,

    "security.workspace.trust.enabled": false,

    "files.autoSave": "afterDelay",
    "editor.formatOnSave": true,

    "code-runner.runInTerminal": true,
    "code-runner.saveFileBeforeRun": true,

    "shellformat.flag": "-i 4",

    "git.autofetch": true
}
EOF

echo "[VSCode] Optional sudo authority..."

if ! sudo grep -q "$(whoami) ALL=(ALL) NOPASSWD:ALL" /etc/sudoers; then
    echo "$(whoami) ALL=(ALL) NOPASSWD:ALL" | sudo EDITOR='tee -a' visudo >/dev/null
fi

echo "[VSCode] Workspace..."
mkdir -p ~/workspace

echo "[âœ“] VSCode environment ready"
BOOTSTRAP
